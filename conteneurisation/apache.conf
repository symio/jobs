# =======================
# Apache Reverse Proxy pour frontend Angular + backend Spring Boot
# =======================

ServerName localhost
ServerAdmin webmaster@localhost

# --- Modules requis ---
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule mime_module modules/mod_mime.so
LoadModule env_module modules/mod_env.so

# --- Répertoire racine du frontend Angular ---
DocumentRoot "/usr/local/apache2/htdocs"
<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted

    # Réécriture pour Angular (SPA fallback -> index.html)
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ /index.html [L]
</Directory>

# --- Proxy configuration ---
ProxyPreserveHost On
ProxyRequests Off

# --- Proxy vers le backend ---
<Location /api/>
    ProxyPass http://backend:8080/jobs/
    ProxyPassReverse http://backend:8080/jobs/

</Location>

# --- Logs ---
#ErrorLog /usr/local/apache2/logs/error.log
#CustomLog /usr/local/apache2/logs/access.log combined
LogLevel warn
LogLevel proxy:trace5 proxy_http:trace5 rewrite:trace3

ErrorLog /dev/stderr
CustomLog /dev/stdout combined
